#!/bin/bash

if [ "$HOSTNAME" = archbook ]; then
    extern=$(xrandr | grep -i "hdmi" | awk '{print $1}')
    intern=$(xrandr | grep -i "edp" | awk '{print $1}')
else
    extern=$(xrandr | grep -i "vga" | awk '{print $1}')
    ext_status=$(xrandr | grep -i "vga" | awk '{print $2}')
    intern=$(xrandr | grep -i "lvds" | awk '{print $1}')
fi

usage() {
    echo "usage:"
    echo "$(basename "$0") [option]"
    echo "  -i, --intern    use $intern only"
    echo "  -e, --extern    use $extern only"
    echo "  -b, --both:     use both"
}

ext_loc_file=/tmp/mhead_loc_file

if [ ! -f "$ext_loc_file" ]; then
    echo "left" > "$ext_loc_file"
fi

use_int () {
    xrandr --output "$intern" --auto --output "$extern" --off
    bspc monitor "$intern" -d I II III IV V
}

use_ext () {
    xrandr --output "$extern" --auto --output "$intern" --off
    bspc monitor "$extern" -d I II III IV V
}

use_both () {
    xrandr --output "$intern" --auto --output "$extern" --auto --left-of "$intern"
    bspc monitor "$extern" -d I II III IV V
    bspc monitor "$intern" -d VI VII VIII IX X
}

case $1 in
    -t | --test )
        echo "LVDS: $intern"
        echo "VGA:  $extern"
        echo "VGA location: $(cat $ext_loc_file)"
        echo "$extern present"
        echo "$intern present"
        exit
        ;;
    -i | --intern )
        $(use_intern)
        ;;
    -e | --extern )
        if [[ $(xrandr | grep "$extern disconnected") ]]; then
            $(use_intern)
        else
            $(use_extern)
        fi
        ;;
    -b | --both)
        $(use_both)
        ;;
    -s | --switch)
        loc=$(< $_loc_file)
        if [ "$loc" = left ]; then
            xrandr --output "$intern" --auto --output "$extern" --auto --right-of "$intern"
            echo "right" > "$ext_loc_file"
        else
            xrandr --output "$intern" --auto --output "$extern" --auto --left-of "$intern"
            echo "left" > "$ext_loc_file"
        fi
        bspc monitor "$extern" -S "$intern"
        ;;
    -h | --help )
        usage
        exit
        ;;
    *)  
        if [[ $(xrandr | grep "$extern disconnected") ]]; then
            $(use_intern)
        else
            $(use_both)
        fi
        ;;
esac
