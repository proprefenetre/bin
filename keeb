#!/usr/bin/env bash

variant=$(setxkbmap -query | rg "variant:\s+(\w+)" -r '$1')

keyboard-mode () {
    setxkbmap -model pc104 \
              -layout us \
              -variant alt-intl \
              -option \
              -option terminate:ctrl_alt_bksp \
              -option ctrl:nocaps
    xmodmap ~/.Xmodmap
    notify-send -a "keyboard" "alt-intl"
}

laptop-mode () {
    setxkbmap -model pc104 \
              -layout us \
              -variant dvorak-alt-intl \
              -option \
              -option terminate:ctrl_alt_bksp \
              -option ctrl:nocaps
    xmodmap ~/.Xmodmap
    notify-send -a "keyboard" "dvorak-alt-intl"
}

case $1 in
    -q | --qwerty)
        keyboard-mode
        ;;

    -d | --dvorak)
        laptop-mode
        ;;

    -t | --toggle)
        if [[ "$variant" = "dvorak-alt-intl" ]]; then
            keyboard-mode
        else
            laptop-mode
        fi
        ;;

    -p | --print)
        echo "variant: $variant"
        setxkbmap -query
        ;;
esac
